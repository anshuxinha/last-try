<!DOCTYPE html>
<html lang="en">
<head>
	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Tint and Shade Generator</title>
	<meta name="title" content="Tint and Shade Generator">
	<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
	<link rel="manifest" href="./site.webmanifest">
	<link rel="mask-icon" href="./safari-pinned-tab.svg" color="#ca228e">
	<meta name="msapplication-TileColor" content="#2b5797">
	<link rel="stylesheet" href="./css/normalize.css">
	<link rel="stylesheet" href="./css/fonts.css">
	<link rel="stylesheet" href="./css/main.css">
	<link rel="stylesheet" href="./css/dark.css">
	<link rel="stylesheet" href="./css/carbon.css">
</head>

<body id="body">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>

<!-- Color Pallete Extraction -->
<div class="main">
    <img src="" alt="" onload="usefulFunctions.getColors()">
    <div class="controls">
      <input type="text" class="inputUrl" placeholder="Paste the image URL">
      <small class="small">or</small>
      <label for="file" class="label">Upload file</label>
      <input type="file" name="file" id="file" class="inputFile">
      <small class="small">Select the number of colors</small>
      <input type="number" class="colorsNumber" value="5">
    </div>
  </div>
  <div class="palette">
  </div>
  <div class="overlay"></div>
  <div class="modal">
    <h1 class="modalTitle">Invalid value</h1>
    <p class="modalText">The number of colors must be between 1 and 20</p>
    <button class="modalButton" onclick="usefulFunctions.hideModal()">Got it!</button>
  </div>
  <div class="copyMessage">Text copied</div>

  <script>
	//DOM declarations to make the coding down there esier
const colorThief = new ColorThief();
const img = document.querySelector("img");
const setter = document.querySelector(".setter");
const link = document.querySelector(".inputUrl");
const main = document.querySelector(".main");
const palette = document.querySelector(".palette");
const label = document.querySelector(".label")
const file = document.querySelector(".inputFile");
const colorN = document.querySelector(".colorsNumber");
const overlay = document.querySelector(".overlay");
const modal = document.querySelector(".modal");
const modalTitle = document.querySelector(".modalTitle");
const modalText = document.querySelector(".modalText");
const modalButton = document.querySelector(".modalButton");
const copyMessage = document.querySelector(".copyMessage");
let colorIndex = 0;
let colorArray = [];
let isWarmColor

//I put all the function here, just to keep it organized
const usefulFunctions = {
  
  //Function rensible for copying the Hex value of determined color
  copyHexColor(id) {
    let numbers = id.replace(/[^0-9]/g, "");
    let copyText = document.getElementById("hexValue" + numbers).innerHTML;
    navigator.clipboard.writeText(copyText);
    usefulFunctions.showCopyMessage();
  },

  //Function rensible for copying the RGB value of determined color
  copyRgbColor(id) {
    let numbers = id.replace(/[^0-9]/g, "");
    let copyText = document.getElementById("colorDesc" + numbers).innerHTML;
    navigator.clipboard.writeText(copyText);
    usefulFunctions.showCopyMessage();
  },

  //Used to convert the RGB to Hex 
  RGBToHex(r, g, b) {
    r = r.toString(16);
    g = g.toString(16);
    b = b.toString(16);

    if (r.length == 1) r = "0" + r;
    if (g.length == 1) g = "0" + g;
    if (b.length == 1) b = "0" + b;

    return "#" + r + g + b;
  },
  
  //Just to set the link from input to the image source
  setImage() {
    img.src = link.value;
    link.value = "";
    palette.innerHTML = "";
  },

  //This is the best part, this function creates the cells that'll show the color and it's respective values, it'll append them in the palette div
  createCells(item) {
	
    const newCell = document.createElement("div");
    newCell.classList.add("colorBox");
    newCell.setAttribute("id", "colorBox" + colorIndex);
    newCell.setAttribute("style", "background-color: rgb(" + item + ")");
    const colorDesc = document.createElement("p");
    colorDesc.classList.add("colorDesc");
    const colorDescText = document.createTextNode("rgb(" + item + ")");
    colorDesc.appendChild(colorDescText);
    colorDesc.setAttribute("id", "colorDesc" + colorIndex);
    colorDesc.onclick = function () {
      usefulFunctions.copyRgbColor(this.id);
    };
    colorDesc.onselectstart = () => {
      return false;
    };
    const hexValue = document.createElement("small");
    const hexValueText = document.createTextNode(
      usefulFunctions.RGBToHex(item[0], item[1], item[2])
    );
    hexValue.onselectstart = () => {
      return false;
    };
    hexValue.appendChild(hexValueText);
    hexValue.classList.add("hexValue");
    hexValue.setAttribute("id", "hexValue" + colorIndex);
    hexValue.onclick = function () {
      usefulFunctions.copyHexColor(this.id);
    };
    const descContainer = document.createElement("div");
    descContainer.classList.add("descContainer");
    descContainer.setAttribute("id", "descContainer" + colorIndex);
    usefulFunctions.testColorTemperature(item[0], item[1], item[2])
    const colorTemperature = document.createElement("small")
    colorTemperature.innerHTML = isWarmColor
    const colorContainer = document.createElement("div");
    descContainer.appendChild(colorDesc);
    descContainer.appendChild(hexValue);
    descContainer.appendChild(colorTemperature)
    colorContainer.classList.add("colorContainer");
    colorContainer.setAttribute("id", "colorContainer" + colorIndex);
    colorContainer.appendChild(newCell);
    colorContainer.appendChild(descContainer);
    palette.appendChild(colorContainer);
    colorIndex++;
	var hexValues = document.querySelectorAll(".hexValue");
	for (let i = 0; i < hexValues.length; i++) {
		document.getElementById ("color-values").value += hexValues[i].textContent + " "
	}
  },

  //the getPalette() from Color Thief
  getColors() {
    colorIndex = 0;
    palette.innerHTML = "";
    img.crossOrigin = "Anonymous";
    colorArray = colorThief.getPalette(img, Number(colorN.value), 10);
    colorArray.forEach(usefulFunctions.createCells);
    usefulFunctions.setBackgroundGradient();
  },
  
  //the getColor() from Color Thief
  getMainColor() {
    colorIndex = 0;
    palette.innerHTML = "";
    let mainColor = colorThief.getColor(img, 10);
    usefulFunctions.createCells(mainColor);
    usefulFunctions.setBackgroundGradient();
  },

  //This one tests the number in the input number field and recall the two above functions depending on the value, also works to limit the 20+ or 0 values
  testColorNumber(colorNumber) {
    if (colorNumber < 1) {
      colorN.value = "1";
      usefulFunctions.showModal();
      usefulFunctions.getMainColor();
    } else if (colorNumber > 20) {
      usefulFunctions.showModal();
      colorN.value = "20";
      usefulFunctions.getColors()
    } else if (colorNumber == 1) {
      usefulFunctions.getMainColor();
    } else if (colorNumber >= 2 && colorNumber <= 20) {
      usefulFunctions.getColors();
    }
  },

  //show the modal error if you set the color number above 20 or below 1
  showModal() {
    overlay.classList.add("active");
    modal.classList.add("active");
  },

  //hide the modal error
  hideModal() {
    overlay.classList.remove("active");
    modal.classList.remove("active");
  },

  //this one will show a "Text Copied" on top of the page whenever you click a RGB or Hex value, will also (obviously) copy the clicked value to transfer area
  showCopyMessage() {
    copyMessage.classList.add("active");
    setTimeout(() => {
      copyMessage.classList.remove("active");
    }, 3000);
  },
  
  //this guy will find the main color (getColor()) of the image and set it as a gradient background, it creates a really coll effect in my opinion
  setBackgroundGradient(){
    let backColor = colorThief.getColor(img, 10)
    main.style.backgroundImage =  'linear-gradient(rgba('+backColor+',0.7), #121212)';
  },
  
  //i made this one just to feed the image with random links from unsplash while i was creating it
  unsplashSetter(){
    img.src=""
    img.src = "https://source.unsplash.com/random"
  },
  
  //This guy will test the color temperature, the values were decided based on a very cool discussion in stack overflow
  testColorTemperature(r, g, b){
    if ((r >= 128 && r <= 255) && (g => 0 && g <= 128) && (b => 0 && b <= r)){
      console.log('warm: '+r+','+g+','+b)
      isWarmColor = "- Warm"
    } else if ((r >= 0 && r <= b) && (g => 0 && g <= 128) && (b => 128 && b <= 255)){
      console.log('cool: '+r+','+g+','+b)
      isWarmColor = "- Cool"
    }
    return isWarmColor
  }
};

//this guys are event listeners that i didn't know where to put :)
link.addEventListener("change", usefulFunctions.setImage);

colorN.addEventListener("change", () => {
  usefulFunctions.testColorNumber(colorN.value);
});

file.onchange = (e) => {
  img.src = URL.createObjectURL(file.files[0]);
  usefulFunctions.testColorNumber();
  usefulFunctions.setBackgroundGradient();
 
};
  </script>



	
	

<!-- Tints and Shades -->
	<a href="#color-values" class="offscreen">Jump to the form</a>

	
	<div class="ts-wrapper">

		<header class="ts-header">
			<div class="ts-headline">
				<h1><a href="/">Tint &amp; Shade Generator</a></h1>
			</div>
		</header>

		<main class="ts-content">

			<div class="ts-form">
				<form class="pure-form" id="color-entry-form" action="#" method="post" name="color-entry-form">
					<div class="labels">
						<div class="form-warning" id="warning">Please enter at least one valid hex color.</div>
						<h2><label class="textarea-label" for="color-values">Enter hex colors (separated by spaces)</label></h2>
					</div>
					<div class="ts-input">
						
						<textarea id="color-values" name="color-values" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
					</div>
					<input id="loadmore" class="button" type="submit" value="Make tints and shades &nbsp;ðŸŽ‰" />
				</form>
			</div>

			<div class="hashtags" id="ts-scroll-top">
				<label class="switch" tabindex="0">
					<input type="checkbox" id="copy-with-hashtag" tabindex="-1">
				  <span class="control"></span>
					<span class="label">Include hashtag when copying</span>
				</label>
			</div>

			<div class="ts-colors">
				<div id="tints-and-shades"></div>
			</div>

		</main>


	</div>

	<script src="./scripts/jquery-3.6.0.min.js"></script>
	<script src="./scripts/tints-and-shades.js"></script>
	<script src="./scripts/clipboard.min.js"></script>
	<script src="./scripts/darken.js"></script>
	<script>
		var clipboard = new ClipboardJS('.hex-color');

		clipboard.on('success', function(e) {
			e.trigger.classList.add("copied");
			setTimeout(function(){
				e.trigger.blur();
			}, 250);
			setTimeout(function(){
				e.trigger.classList.remove("copied");
			}, 1500);

			e.clearSelection();
		});
	</script>

</body>

</html>
